on:
  push:
    branches:
      - development
      - principios
name: 🚀 Deploy dev
jobs:
  build:
    name: 🌐 Deploy Back
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Create database.ini file
        env:
          DBServ: localhost
          DBConn: mysql
          DBName: ${{ secrets.DBNameDev }}
          DBUser: ${{ secrets.DBUserDev }}
          DBPass: ${{ secrets.DBPassDev }}
        run: |
          touch database.ini
          echo DBServ	= $DBServ >> database.ini
          echo DBConn	= $DBConn >> database.ini
          echo DBName	= $DBName >> database.ini
          echo DBUser	= $DBUser >> database.ini
          echo DBPass	= $DBPass >> database.ini

          echo "cat database.ini"
          cat database.ini

      - run: ls -l

      - name: Delete file
        run: rm -f db/database.ini

      - run: ls -l

      - name: Rename database.ini
        run: mv database.ini db/database.ini

      - run: ls -l

      - name: 🎉 Deploy
        uses: SamKirkland/FTP-Deploy-Action@4.3.0
        with:
          server: ftp.casaloca.es
          username: ${{ secrets.ftp_username }}
          password: ${{ secrets.ftp_password }}
          local-dir: ./back/
          server-dir: /tfg_dev/
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
            **/vendor/**
